# Crawl meassage data from facebookAPI
token = "EAACEdEose0cBAL4jqM4tJmAICtV93Mk756ZC3d1BGWgznA6Wsn6aAwAwQzRuHbOdO4IvRgJM5GUnHWXkBuFxrp9R9bJOnTT1gCCLFFfy4ErQykjUaZBHDhn3BzcaLMVo3U0fv1SChzImGrWtSYx1fy9mGArChx4NY9k5ONMvIV1svlojSaZBPlRGvp6wJMZD"
FacebookID = "enc.teia"
url_1 = "https://graph.facebook.com/v2.12/"
# Crawl Posts data from facebookAPI
url_1 = "https://graph.facebook.com/v3.0/"
url_2 = "?fields=posts.limit(25)&access_token="
url = paste0(url_1,FacebookID,url_2,token)
response = GET(url)
Posts  = content(response)
# Get posts/message from post <List>
Posts <- Posts$posts$data
library(jsonlite)
library(httr)
library(magrittr)
# Crawl meassage data from facebookAPI
token = "EAACEdEose0cBAL4jqM4tJmAICtV93Mk756ZC3d1BGWgznA6Wsn6aAwAwQzRuHbOdO4IvRgJM5GUnHWXkBuFxrp9R9bJOnTT1gCCLFFfy4ErQykjUaZBHDhn3BzcaLMVo3U0fv1SChzImGrWtSYx1fy9mGArChx4NY9k5ONMvIV1svlojSaZBPlRGvp6wJMZD"
FacebookID = "enc.teia"
# Crawl Posts data from facebookAPI
url_1 = "https://graph.facebook.com/v3.0/"
url_2 = "?fields=posts.limit(25)&access_token="
url = paste0(url_1,FacebookID,url_2,token)
response = GET(url)
Posts  = content(response)
# Get posts/message from post <List>
Posts <- Posts$posts$data
# Get post create time
ismessageidx
View(Posts)
for(i in 25){
Time <- c(Time,Posts[[i]]$created_time)
}
Time <- c()
for(i in 25){
Time <- c(Time,Posts[[i]]$created_time)
}
Time
for(i in c(1:25)){
Time <- c(Time,Posts[[i]]$created_time)
}
Time
# Get post create time
ismessageidx = c(1:25)
Time <- c()
for(i in ismessageidx){
Time <- c(Time,Posts[[i]]$created_time)
}
Time
# Get post data
post_data <- Posts %>% do.call(rbind,.) %>% data.frame
View(post_data)
# Get post data
post_data <- Posts %>% do.call(rbind,.) %>% data.frame
View(post_data)
FacebookID = "DoctorKoWJ"
# Crawl meassage data from facebookAPI
token = "EAACEdEose0cBAL4jqM4tJmAICtV93Mk756ZC3d1BGWgznA6Wsn6aAwAwQzRuHbOdO4IvRgJM5GUnHWXkBuFxrp9R9bJOnTT1gCCLFFfy4ErQykjUaZBHDhn3BzcaLMVo3U0fv1SChzImGrWtSYx1fy9mGArChx4NY9k5ONMvIV1svlojSaZBPlRGvp6wJMZD"
# Crawl Posts data from facebookAPI
url_1 = "https://graph.facebook.com/v3.0/"
url_2 = "?fields=posts.limit(1000)&access_token="
url = paste0(url_1,FacebookID,url_2,token)
response = GET(url)
Posts  = content(response)
# Get posts/message from post <List>
Posts <- Posts$posts$data
# Get post data
post_data <- Posts %>% do.call(rbind,.) %>% data.frame
# Get posts/message from post <List>
Posts <- Posts$posts$data
View(post_data)
# Crawl Posts data from facebookAPI
url_1 = "https://graph.facebook.com/v3.0/"
# Crawl Posts data from facebookAPI
url_1 = "https://graph.facebook.com/v3.0/"
url_2 = "?fields=posts.limit(200)&access_token="
url = paste0(url_1,FacebookID,url_2,token)
response = GET(url)
Posts  = content(response)
# Get posts/message from post <List>
Posts <- Posts$posts$data
# Get post data
post_data <- Posts %>% do.call(rbind,.) %>% data.frame
View(post_data)
##################################################################
# get shares from every post
url_1 = "https://graph.facebook.com/v3.0/"
##################################################################
# get shares from every post
url_1 = "https://graph.facebook.com/v3.0/"
url_2 = "?fields=posts.limit(200){shares}&access_token="
url = paste0(url_1,FacebookID,url_2,token)
response = GET(url)
shares  = content(response)
shares <- shares$posts$data
shares[[1]]$shares[[1]]
shareCT <- c()
for(i in c(1:25)){
shareCT <- c(shareCT,shares[[i]]$shares[[1]])
}
shareCT
for(i in c(1:200)){
shareCT <- c(shareCT,shares[[i]]$shares[[1]])
}
shareCT
##################################################################
# get shares from every post
url_1 = "https://graph.facebook.com/v3.0/"
url_2 = "?fields=posts.limit(200){likes}&access_token="
url = paste0(url_1,FacebookID,url_2,token)
response = GET(url)
shares  = content(response)
shares <- shares$posts$data
shares[[1]]$shares[[1]]
shareCT <- c()
for(i in c(1:200)){
shareCT <- c(shareCT,shares[[i]]$shares[[1]])
}
shareCT
##################################################################
# get shares from every post
url_1 = "https://graph.facebook.com/v3.0/"
url_2 = "?fields=posts.limit(200){shares}&access_token="
url = paste0(url_1,FacebookID,url_2,token)
response = GET(url)
shares  = content(response)
shares <- shares$posts$data
shares[[1]]$shares[[1]]
shareCT <- c()
for(i in c(1:200)){
shareCT <- c(shareCT,shares[[i]]$shares[[1]])
}
shareCT
url = "https://graph.facebook.com/{136845026417486_1311790355589608}/reactions?summary=total_count&access_token={EAACEdEose0cBAL4jqM4tJmAICtV93Mk756ZC3d1BGWgznA6Wsn6aAwAwQzRuHbOdO4IvRgJM5GUnHWXkBuFxrp9R9bJOnTT1gCCLFFfy4ErQykjUaZBHDhn3BzcaLMVo3U0fv1SChzImGrWtSYx1fy9mGArChx4NY9k5ONMvIV1svlojSaZBPlRGvp6wJMZD}"
response = GET(url)
View(Posts)
shares  = content(response)
View(shares)
url = "https://graph.facebook.com/{136845026417486_1311790355589608}/reactions?summary=total_count&access_token={EAACEdEose0cBAL4jqM4tJmAICtV93Mk756ZC3d1BGWgznA6Wsn6aAwAwQzRuHbOdO4IvRgJM5GUnHWXkBuFxrp9R9bJOnTT1gCCLFFfy4ErQykjUaZBHDhn3BzcaLMVo3U0fv1SChzImGrWtSYx1fy9mGArChx4NY9k5ONMvIV1svlojSaZBPlRGvp6wJMZD}"
response = GET(url)
shares  = content(response)
setwd("~/")
setwd("E:/GitHub/NTU-CSX-DataScience--Group5/Finalproject/UDN")
data <- read.csv(Output2)
data <- read.csv("Output2")
View(data)
335+500
library(httr)
library(rvest)
library(yaml)
library(magrittr)
setwd("/Users/sunny/Documents/GitHub/courseR/final_project")
news_links = read.csv( file = "Ko_udnlinks")
colnames(news_links) <- c("ID","URL")
news_links$URL <- news_links$URL %>% as.character()
#爬每一篇新聞的標題、時間、內文
#這邊要寫成function
length(news_links$URL)
unique(news_links$URL)
title <- c()
time <- c()
text <- c()
FindNews <- function(URL){
t.doc <-  read_html(URL %>% as.character())
title_node <- html_node(t.doc, "#story_art_title")
t_title <- html_text(title_node)
title <- rbind(title, t_title)
time_node <- html_node(t.doc, "#story_bady_info > div > span")
t_time <- html_text(time_node)
time <- rbind(time, t_time)
text_node <- html_nodes(t.doc, "#story_body_content > p")
t_text <- html_text(text_node)
bindtext <- ""
for(i in c(1:length(t_text))){
bindtext <- paste(bindtext,t_text[i])
}
return(cbind(title, time, bindtext))
}
Output3 <- data.frame()
Output3 <- data.frame()
for( i in 836:3240){
print(i)
data <- FindNews(news_links[i,2])
Output3 <- rbind(Output3,data)
Sys.sleep(sample(1:10,1))
}
write.csv(Output3,file="Output3")
